{% extends "base.html" %}

{% block title %}ê±´ê°•ê´€ë¦¬ - ë°ì¼ë¦¬ì¼€ì–´{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dailycare.css') }}">
{% endblock %}

{% block content %}
<div class="health-container">
    <div class="health-header">
        <div class="breadcrumb">
            <a href="{{ url_for('dailycare.index') }}">ë°ì¼ë¦¬ì¼€ì–´</a>
            <i class="fas fa-chevron-right"></i>
            <span>ê±´ê°•ê´€ë¦¬</span>
        </div>
        <h2>ê±´ê°•ê´€ë¦¬</h2>
        <p>ë°˜ë ¤ë™ë¬¼ì˜ ê±´ê°• ìƒíƒœë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</p>
    </div>

    <!-- ë°˜ë ¤ë™ë¬¼ ì„ íƒ -->
    <div class="pet-selector">
        <div class="pet-tabs">
            <button class="pet-tab active" data-pet="1">
                <div class="pet-avatar">ğŸ•</div>
                <span>ë©ë©ì´</span>
            </button>
            <button class="pet-tab" data-pet="2">
                <div class="pet-avatar">ğŸ±</div>
                <span>ì•¼ì˜¹ì´</span>
            </button>
        </div>
    </div>

    <!-- ê±´ê°• ê°œìš” -->
    <div class="health-overview">
        <div class="overview-card">
            <div class="card-header">
                <h3>í˜„ì¬ ê±´ê°• ìƒíƒœ</h3>
                <div class="health-status good">
                    <i class="fas fa-heart"></i>
                    <span>ì–‘í˜¸</span>
                </div>
            </div>
            <div class="vital-signs">
                <div class="vital-item">
                    <div class="vital-label">ì²´ì¤‘</div>
                    <div class="vital-value">25.2kg</div>
                    <div class="vital-change neutral">â†’</div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">ì²´ì˜¨</div>
                    <div class="vital-value">38.1Â°C</div>
                    <div class="vital-change good">â†“</div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">ì‹¬ë°•ìˆ˜</div>
                    <div class="vital-value">85 bpm</div>
                    <div class="vital-change good">â†’</div>
                </div>
                <div class="vital-item">
                    <div class="vital-label">ë§ˆì§€ë§‰ ê²€ì§„</div>
                    <div class="vital-value">2024.12.15</div>
                    <div class="vital-note">26ì¼ ì „</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
    <div class="quick-actions">
        <button class="action-btn" onclick="recordVitals()">
            <i class="fas fa-thermometer-half"></i>
            <span>ì²´ì˜¨/ì²´ì¤‘ ê¸°ë¡</span>
        </button>
        <button class="action-btn" onclick="recordSymptom()">
            <i class="fas fa-notes-medical"></i>
            <span>ì¦ìƒ ê¸°ë¡</span>
        </button>
        <button class="action-btn" onclick="scheduleCheckup()">
            <i class="fas fa-calendar-plus"></i>
            <span>ê²€ì§„ ì˜ˆì•½</span>
        </button>
        <button class="action-btn" onclick="viewMedicalHistory()">
            <i class="fas fa-file-medical"></i>
            <span>ì§„ë£Œ ê¸°ë¡</span>
        </button>
    </div>

    <!-- ì²´ì¤‘ ì°¨íŠ¸ -->
    <div class="chart-section">
        <div class="chart-header">
            <h3>ì²´ì¤‘ ë³€í™” ì¶”ì´</h3>
            <div class="chart-controls">
                <select id="weight-period">
                    <option value="1month">1ê°œì›”</option>
                    <option value="3months">3ê°œì›”</option>
                    <option value="6months">6ê°œì›”</option>
                    <option value="1year">1ë…„</option>
                </select>
            </div>
        </div>
        <div class="chart-container">
            <!-- TODO: ì‹¤ì œ ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—°ë™ -->
            <div class="chart-placeholder">
                <canvas id="weight-chart" width="600" height="300"></canvas>
            </div>
        </div>
    </div>

    <!-- ì˜ˆë°©ì ‘ì¢… í˜„í™© -->
    <div class="vaccination-section">
        <div class="section-header">
            <h3>ì˜ˆë°©ì ‘ì¢… í˜„í™©</h3>
            <button class="btn btn-outline btn-sm" onclick="addVaccination()">
                <i class="fas fa-plus"></i> ì ‘ì¢… ì¶”ê°€
            </button>
        </div>
        <div class="vaccination-list">
            <div class="vaccination-item completed">
                <div class="vaccination-icon">
                    <i class="fas fa-syringe"></i>
                </div>
                <div class="vaccination-info">
                    <h4>ê´‘ê²¬ë³‘ ì˜ˆë°©ì ‘ì¢…</h4>
                    <p class="vaccination-date">2024.12.15 ì ‘ì¢… ì™„ë£Œ</p>
                    <p class="next-date">ë‹¤ìŒ ì ‘ì¢…: 2025.12.15</p>
                </div>
                <div class="vaccination-status">
                    <span class="status-badge completed">ì™„ë£Œ</span>
                </div>
            </div>

            <div class="vaccination-item upcoming">
                <div class="vaccination-icon">
                    <i class="fas fa-syringe"></i>
                </div>
                <div class="vaccination-info">
                    <h4>ì¢…í•©ë°±ì‹  (DHPPL)</h4>
                    <p class="vaccination-date">2024.11.15 ì ‘ì¢… ì™„ë£Œ</p>
                    <p class="next-date">ë‹¤ìŒ ì ‘ì¢…: 2025.11.15 (10ê°œì›” í›„)</p>
                </div>
                <div class="vaccination-status">
                    <span class="status-badge upcoming">ì˜ˆì •</span>
                </div>
            </div>

            <div class="vaccination-item overdue">
                <div class="vaccination-icon">
                    <i class="fas fa-syringe"></i>
                </div>
                <div class="vaccination-info">
                    <h4>ì¼„ë„¬ì½”í”„ ì˜ˆë°©ì ‘ì¢…</h4>
                    <p class="vaccination-date">2024.07.15 ì ‘ì¢… ì™„ë£Œ</p>
                    <p class="next-date">ë‹¤ìŒ ì ‘ì¢…: 2025.01.15 (3ì¼ ì „)</p>
                </div>
                <div class="vaccination-status">
                    <span class="status-badge overdue">ì§€ì—°</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ê±´ê°• ê¸°ë¡ -->
    <div class="health-records">
        <div class="section-header">
            <h3>ìµœê·¼ ê±´ê°• ê¸°ë¡</h3>
            <button class="btn btn-outline btn-sm" onclick="viewAllRecords()">
                ì „ì²´ë³´ê¸°
            </button>
        </div>
        <div class="records-list">
            <div class="record-item">
                <div class="record-date">
                    <div class="date">15</div>
                    <div class="month">1ì›”</div>
                </div>
                <div class="record-content">
                    <h4>ì •ê¸° ê±´ê°•ê²€ì§„</h4>
                    <p>ì „ì²´ì ìœ¼ë¡œ ê±´ê°•ìƒíƒœ ì–‘í˜¸. ì²´ì¤‘ ê´€ë¦¬ í•„ìš”</p>
                    <div class="record-tags">
                        <span class="tag">ê²€ì§„</span>
                        <span class="tag">ì²´ì¤‘ê´€ë¦¬</span>
                    </div>
                </div>
                <div class="record-actions">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="record-item">
                <div class="record-date">
                    <div class="date">10</div>
                    <div class="month">1ì›”</div>
                </div>
                <div class="record-content">
                    <h4>ì²´ì¤‘ ì¸¡ì •</h4>
                    <p>25.2kg (ì „íšŒ ëŒ€ë¹„ +0.3kg)</p>
                    <div class="record-tags">
                        <span class="tag">ì²´ì¤‘</span>
                    </div>
                </div>
                <div class="record-actions">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="record-item">
                <div class="record-date">
                    <div class="date">08</div>
                    <div class="month">1ì›”</div>
                </div>
                <div class="record-content">
                    <h4>ì„¤ì‚¬ ì¦ìƒ</h4>
                    <p>ê°€ë²¼ìš´ ì„¤ì‚¬ ì¦ìƒ ìˆì—ˆìœ¼ë‚˜ í•˜ë£¨ ë§Œì— íšŒë³µ</p>
                    <div class="record-tags">
                        <span class="tag">ì¦ìƒ</span>
                        <span class="tag">ì†Œí™”ê¸°</span>
                    </div>
                </div>
                <div class="record-actions">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë³µìš© ì¤‘ì¸ ì•½ë¬¼ -->
    <div class="medication-section">
        <div class="section-header">
            <h3>ë³µìš© ì¤‘ì¸ ì•½ë¬¼/ì˜ì–‘ì œ</h3>
            <button class="btn btn-outline btn-sm" onclick="addMedication()">
                <i class="fas fa-plus"></i> ì•½ë¬¼ ì¶”ê°€
            </button>
        </div>
        <div class="medication-list">
            <div class="medication-item">
                <div class="medication-icon">
                    <i class="fas fa-pills"></i>
                </div>
                <div class="medication-info">
                    <h4>ê´€ì ˆ ì˜ì–‘ì œ</h4>
                    <p class="dosage">1ì¼ 1ì •, ì‹í›„ ë³µìš©</p>
                    <p class="duration">2024.12.01 ~ 2025.02.28</p>
                </div>
                <div class="medication-status">
                    <span class="status-badge active">ë³µìš©ì¤‘</span>
                </div>
            </div>

            <div class="medication-item">
                <div class="medication-icon">
                    <i class="fas fa-capsules"></i>
                </div>
                <div class="medication-info">
                    <h4>ìœ ì‚°ê· </h4>
                    <p class="dosage">1ì¼ 1íšŒ, ì•„ì¹¨ ì‹ì‚¬ì™€ í•¨ê»˜</p>
                    <p class="duration">ìƒì‹œ ë³µìš©</p>
                </div>
                <div class="medication-status">
                    <span class="status-badge active">ë³µìš©ì¤‘</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ì²´ì˜¨/ì²´ì¤‘ ê¸°ë¡ ëª¨ë‹¬ -->
<div class="modal" id="vitals-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ì²´ì˜¨/ì²´ì¤‘ ê¸°ë¡</h3>
            <button class="modal-close" onclick="closeVitalsModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="vitals-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>ì²´ì¤‘ (kg)</label>
                        <input type="number" name="weight" step="0.1" placeholder="25.2">
                    </div>
                    <div class="form-group">
                        <label>ì²´ì˜¨ (Â°C)</label>
                        <input type="number" name="temperature" step="0.1" placeholder="38.1">
                    </div>
                </div>
                <div class="form-group">
                    <label>ë©”ëª¨</label>
                    <textarea name="memo" placeholder="íŠ¹ì´ì‚¬í•­ì´ ìˆë‹¤ë©´ ê¸°ë¡í•´ì£¼ì„¸ìš”" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeVitalsModal()">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ê¸°ë¡í•˜ê¸°
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ì¦ìƒ ê¸°ë¡ ëª¨ë‹¬ -->
<div class="modal" id="symptom-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ì¦ìƒ ê¸°ë¡</h3>
            <button class="modal-close" onclick="closeSymptomModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="symptom-form">
                <div class="form-group">
                    <label>ì¦ìƒ ì¹´í…Œê³ ë¦¬</label>
                    <select name="category" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="digestive">ì†Œí™”ê¸°ê³„</option>
                        <option value="respiratory">í˜¸í¡ê¸°ê³„</option>
                        <option value="skin">í”¼ë¶€</option>
                        <option value="behavior">í–‰ë™/ì •ì‹ </option>
                        <option value="eye">ëˆˆ</option>
                        <option value="ear">ê·€</option>
                        <option value="etc">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì¦ìƒ ì„¤ëª…</label>
                    <textarea name="description" required placeholder="ì¦ìƒì„ ìì„¸íˆ ê¸°ë¡í•´ì£¼ì„¸ìš”" rows="4"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì‹¬ê°ë„</label>
                        <select name="severity">
                            <option value="mild">ê²½ë¯¸</option>
                            <option value="moderate">ë³´í†µ</option>
                            <option value="severe">ì‹¬ê°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ì§€ì† ì‹œê°„</label>
                        <input type="text" name="duration" placeholder="ì˜ˆ: 3ì¼ì§¸, 1ì‹œê°„">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeSymptomModal()">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ê¸°ë¡í•˜ê¸°
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dailycare.js') }}"></script>
<script>
// ëª¨ë‹¬ ê´€ë¦¬
function recordVitals() {
    document.getElementById('vitals-modal').classList.add('active');
}

function closeVitalsModal() {
    document.getElementById('vitals-modal').classList.remove('active');
    document.getElementById('vitals-form').reset();
}

function recordSymptom() {
    document.getElementById('symptom-modal').classList.add('active');
}

function closeSymptomModal() {
    document.getElementById('symptom-modal').classList.remove('active');
    document.getElementById('symptom-form').reset();
}

// ë°˜ë ¤ë™ë¬¼ íƒ­ ì „í™˜
document.querySelectorAll('.pet-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        document.querySelectorAll('.pet-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        const petId = this.dataset.pet;
        loadPetHealthData(petId);
    });
});

// ì²´ì˜¨/ì²´ì¤‘ ê¸°ë¡ í¼ ì œì¶œ
document.getElementById('vitals-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    try {
        // TODO: ì‹¤ì œ API í˜¸ì¶œ
        alert('ì²´ì˜¨/ì²´ì¤‘ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        closeVitalsModal();
        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        location.reload();
    } catch (error) {
        alert('ê¸°ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
});

// ì¦ìƒ ê¸°ë¡ í¼ ì œì¶œ
document.getElementById('symptom-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    try {
        // TODO: ì‹¤ì œ API í˜¸ì¶œ
        alert('ì¦ìƒì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        closeSymptomModal();
        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        location.reload();
    } catch (error) {
        alert('ê¸°ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
});

// ê¸°íƒ€ ê¸°ëŠ¥ë“¤
function scheduleCheckup() {
    alert('ê²€ì§„ ì˜ˆì•½ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
}

function viewMedicalHistory() {
    alert('ì§„ë£Œ ê¸°ë¡ ì¡°íšŒ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
}

function addVaccination() {
    alert('ì˜ˆë°©ì ‘ì¢… ì¶”ê°€ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
}

function addMedication() {
    alert('ì•½ë¬¼ ì¶”ê°€ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
}

function viewAllRecords() {
    alert('ì „ì²´ ê±´ê°• ê¸°ë¡ ì¡°íšŒ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
}

function loadPetHealthData(petId) {
    // TODO: ì„ íƒëœ ë°˜ë ¤ë™ë¬¼ì˜ ê±´ê°• ë°ì´í„° ë¡œë“œ
    console.log('ë¡œë“œí•  ë°˜ë ¤ë™ë¬¼ ID:', petId);
}

// ì°¨íŠ¸ ê¸°ê°„ ë³€ê²½
document.getElementById('weight-period').addEventListener('change', function() {
    const period = this.value;
    // TODO: ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
    console.log('ì°¨íŠ¸ ê¸°ê°„ ë³€ê²½:', period);
});

// ê°„ë‹¨í•œ ì²´ì¤‘ ì°¨íŠ¸ ê·¸ë¦¬ê¸° (ì‹¤ì œë¡œëŠ” Chart.js ë“± ì‚¬ìš©)
function drawWeightChart() {
    const canvas = document.getElementById('weight-chart');
    const ctx = canvas.getContext('2d');
    
    // ìƒ˜í”Œ ë°ì´í„°
    const data = [24.8, 25.0, 24.9, 25.1, 25.2, 25.0, 25.2];
    const labels = ['12/15', '12/22', '12/29', '1/5', '1/12', '1/19', '1/26'];
    
    // ê°„ë‹¨í•œ ì„  ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = '#ff6b6b';
    ctx.lineWidth = 2;
    
    const padding = 40;
    const chartWidth = canvas.width - padding * 2;
    const chartHeight = canvas.height - padding * 2;
    
    ctx.beginPath();
    for (let i = 0; i < data.length; i++) {
        const x = padding + (i * chartWidth / (data.length - 1));
        const y = padding + chartHeight - ((data[i] - 24.5) / 1 * chartHeight);
        
        if (i === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
        
        // ë°ì´í„° í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
        ctx.fillStyle = '#ff6b6b';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
        ctx.beginPath();
        ctx.strokeStyle = '#ff6b6b';
    }
    ctx.stroke();
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
document.addEventListener('DOMContentLoaded', function() {
    drawWeightChart();
});

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.remove('active');
        }
    });
});
</script>
{% endblock %}