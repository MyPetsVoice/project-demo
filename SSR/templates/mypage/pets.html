{% extends "base.html" %}

{% block title %}ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬ - MyPet's Voice{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/mypage.css') }}">
{% endblock %}

{% block content %}
<div class="pets-management-container">
    <div class="pets-header">
        <div class="breadcrumb">
            <a href="{{ url_for('mypage.index') }}">ë§ˆì´í˜ì´ì§€</a>
            <i class="fas fa-chevron-right"></i>
            <span>ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬</span>
        </div>
        <h2>ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬</h2>
        <p>ì†Œì¤‘í•œ ë°˜ë ¤ë™ë¬¼ë“¤ì˜ ì •ë³´ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</p>
    </div>

    <div class="pets-actions">
        <button class="btn btn-primary" onclick="addNewPet()">
            <i class="fas fa-plus"></i> ìƒˆ ë°˜ë ¤ë™ë¬¼ ì¶”ê°€
        </button>
    </div>

    <div class="pets-grid">
        <!-- ê¸°ì¡´ ë°˜ë ¤ë™ë¬¼ ì¹´ë“œ -->
        <div class="pet-card-detailed">
            <div class="pet-image-section">
                <div class="pet-image">
                    <img src="https://via.placeholder.com/200x200/ff6b6b/ffffff?text=ğŸ•" alt="ë©ë©ì´">
                </div>
                <div class="pet-status-badge healthy">
                    <i class="fas fa-heart"></i>
                    ê±´ê°•
                </div>
            </div>
            
            <div class="pet-info-section">
                <div class="pet-header">
                    <h3>ë©ë©ì´</h3>
                    <div class="pet-actions">
                        <button class="action-btn" onclick="editPet(1)" title="í¸ì§‘">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="viewPetDetail(1)" title="ìƒì„¸ë³´ê¸°">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn danger" onclick="deletePet(1)" title="ì‚­ì œ">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="pet-basic-info">
                    <div class="info-row">
                        <span class="info-label">í’ˆì¢…</span>
                        <span class="info-value">ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ë‚˜ì´</span>
                        <span class="info-value">3ì„¸ (2022ë…„ìƒ)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ì„±ë³„</span>
                        <span class="info-value">ìˆ˜ì»· (ì¤‘ì„±í™” ì™„ë£Œ)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ì²´ì¤‘</span>
                        <span class="info-value">25.2kg</span>
                    </div>
                </div>

                <div class="pet-health-summary">
                    <h4>ê±´ê°• ìš”ì•½</h4>
                    <div class="health-items">
                        <div class="health-item">
                            <i class="fas fa-syringe"></i>
                            <span>ì˜ˆë°©ì ‘ì¢… ì™„ë£Œ</span>
                        </div>
                        <div class="health-item">
                            <i class="fas fa-cut"></i>
                            <span>ì¤‘ì„±í™” ì™„ë£Œ</span>
                        </div>
                        <div class="health-item">
                            <i class="fas fa-calendar-check"></i>
                            <span>ê±´ê°•ê²€ì§„ 2024.12.15</span>
                        </div>
                    </div>
                </div>

                <div class="pet-tags">
                    <span class="pet-tag">í™œë°œí•¨</span>
                    <span class="pet-tag">ì‚¬ëŒ ì¢‹ì•„í•¨</span>
                    <span class="pet-tag">ê³µë†€ì´</span>
                </div>
            </div>
        </div>

        <div class="pet-card-detailed">
            <div class="pet-image-section">
                <div class="pet-image">
                    <img src="https://via.placeholder.com/200x200/9b59b6/ffffff?text=ğŸ±" alt="ì•¼ì˜¹ì´">
                </div>
                <div class="pet-status-badge healthy">
                    <i class="fas fa-heart"></i>
                    ê±´ê°•
                </div>
            </div>
            
            <div class="pet-info-section">
                <div class="pet-header">
                    <h3>ì•¼ì˜¹ì´</h3>
                    <div class="pet-actions">
                        <button class="action-btn" onclick="editPet(2)" title="í¸ì§‘">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="viewPetDetail(2)" title="ìƒì„¸ë³´ê¸°">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn danger" onclick="deletePet(2)" title="ì‚­ì œ">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="pet-basic-info">
                    <div class="info-row">
                        <span class="info-label">í’ˆì¢…</span>
                        <span class="info-value">ëŸ¬ì‹œì•ˆ ë¸”ë£¨</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ë‚˜ì´</span>
                        <span class="info-value">2ì„¸ (2023ë…„ìƒ)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ì„±ë³„</span>
                        <span class="info-value">ì•”ì»· (ì¤‘ì„±í™” ì™„ë£Œ)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ì²´ì¤‘</span>
                        <span class="info-value">4.1kg</span>
                    </div>
                </div>

                <div class="pet-health-summary">
                    <h4>ê±´ê°• ìš”ì•½</h4>
                    <div class="health-items">
                        <div class="health-item">
                            <i class="fas fa-syringe"></i>
                            <span>ì˜ˆë°©ì ‘ì¢… ì™„ë£Œ</span>
                        </div>
                        <div class="health-item">
                            <i class="fas fa-cut"></i>
                            <span>ì¤‘ì„±í™” ì™„ë£Œ</span>
                        </div>
                        <div class="health-item warning">
                            <i class="fas fa-calendar-times"></i>
                            <span>ê±´ê°•ê²€ì§„ ì˜ˆì •</span>
                        </div>
                    </div>
                </div>

                <div class="pet-tags">
                    <span class="pet-tag">ì¡°ìš©í•¨</span>
                    <span class="pet-tag">ë…ë¦½ì </span>
                    <span class="pet-tag">ì¥ë‚œê° ì¢‹ì•„í•¨</span>
                </div>
            </div>
        </div>

        <!-- ìƒˆ ë°˜ë ¤ë™ë¬¼ ì¶”ê°€ ì¹´ë“œ -->
        <div class="pet-card-add" onclick="addNewPet()">
            <div class="add-content">
                <div class="add-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <h3>ìƒˆ ë°˜ë ¤ë™ë¬¼ ì¶”ê°€</h3>
                <p>ì†Œì¤‘í•œ ë°˜ë ¤ë™ë¬¼ì„ ë“±ë¡í•´ë³´ì„¸ìš”</p>
            </div>
        </div>
    </div>

    <!-- í†µê³„ ì„¹ì…˜ -->
    <div class="pets-statistics">
        <h3>ë°˜ë ¤ë™ë¬¼ í†µê³„</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-paw"></i>
                </div>
                <div class="stat-content">
                    <h4>ì´ ë°˜ë ¤ë™ë¬¼</h4>
                    <div class="stat-number">2ë§ˆë¦¬</div>
                    <div class="stat-detail">ê°•ì•„ì§€ 1ë§ˆë¦¬, ê³ ì–‘ì´ 1ë§ˆë¦¬</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-birthday-cake"></i>
                </div>
                <div class="stat-content">
                    <h4>í‰ê·  ë‚˜ì´</h4>
                    <div class="stat-number">2.5ì„¸</div>
                    <div class="stat-detail">ê±´ê°•í•œ ì Šì€ ë°˜ë ¤ë™ë¬¼ë“¤</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="stat-content">
                    <h4>ê±´ê°• ìƒíƒœ</h4>
                    <div class="stat-number">100%</div>
                    <div class="stat-detail">ëª¨ë“  ë°˜ë ¤ë™ë¬¼ì´ ê±´ê°•</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-content">
                    <h4>ì˜ˆì •ëœ ì¼ì •</h4>
                    <div class="stat-number">3ê°œ</div>
                    <div class="stat-detail">ì˜ˆë°©ì ‘ì¢…, ê±´ê°•ê²€ì§„ ë“±</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ë°˜ë ¤ë™ë¬¼ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
<div class="modal large" id="pet-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="pet-modal-title">ìƒˆ ë°˜ë ¤ë™ë¬¼ ì¶”ê°€</h3>
            <button class="modal-close" onclick="closePetModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="pet-form">
                <div class="form-section">
                    <h4>ê¸°ë³¸ ì •ë³´</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì´ë¦„ *</label>
                            <input type="text" name="name" required placeholder="ë°˜ë ¤ë™ë¬¼ ì´ë¦„">
                        </div>
                        <div class="form-group">
                            <label>ì¢…ë¥˜ *</label>
                            <select name="species" required onchange="updateBreedOptions()">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="dog">ê°•ì•„ì§€</option>
                                <option value="cat">ê³ ì–‘ì´</option>
                                <option value="rabbit">í† ë¼</option>
                                <option value="bird">ìƒˆ</option>
                                <option value="hamster">í–„ìŠ¤í„°</option>
                                <option value="etc">ê¸°íƒ€</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>í’ˆì¢…</label>
                            <select name="breed" id="breed-select">
                                <option value="">ì¢…ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì„±ë³„</label>
                            <select name="gender">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="male">ìˆ˜ì»·</option>
                                <option value="female">ì•”ì»·</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ìƒë…„ì›”ì¼</label>
                            <input type="date" name="birth_date">
                        </div>
                        <div class="form-group">
                            <label>ì…ì–‘ì¼</label>
                            <input type="date" name="adoption_date">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ì²´ì¤‘ (kg)</label>
                            <input type="number" name="weight" step="0.1" placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label>ë§ˆì´í¬ë¡œì¹© ë²ˆí˜¸</label>
                            <input type="text" name="microchip" placeholder="ë§ˆì´í¬ë¡œì¹© ë²ˆí˜¸">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>ê±´ê°• ì •ë³´</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="checkbox-wrapper">
                                <input type="checkbox" name="neutered">
                                <span class="checkmark"></span>
                                ì¤‘ì„±í™” ì™„ë£Œ
                            </label>
                        </div>
                        <div class="form-group">
                            <label>ì¤‘ì„±í™” ë‚ ì§œ</label>
                            <input type="date" name="neuter_date">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ì•Œë ˆë¥´ê¸°</label>
                        <textarea name="allergies" placeholder="ì•Œë ˆë¥´ê¸°ê°€ ìˆë‹¤ë©´ ê¸°ë¡í•´ì£¼ì„¸ìš”" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label>íŠ¹ì´ì‚¬í•­</label>
                        <textarea name="special_notes" placeholder="ê±´ê°•ìƒ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ì£¼ì˜í•  ì " rows="3"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h4>ì„±ê²© ë° íŠ¹ì„±</h4>
                    <div class="form-group">
                        <label>ì„±ê²© íƒœê·¸</label>
                        <div class="personality-tags">
                            <label class="tag-item">
                                <input type="checkbox" name="personality" value="friendly">
                                <span>ì¹œí™”ì </span>
                            </label>
                            <label class="tag-item">
                                <input type="checkbox" name="personality" value="active">
                                <span>í™œë°œí•¨</span>
                            </label>
                            <label class="tag-item">
                                <input type="checkbox" name="personality" value="calm">
                                <span>ì°¨ë¶„í•¨</span>
                            </label>
                            <label class="tag-item">
                                <input type="checkbox" name="personality" value="playful">
                                <span>ì¥ë‚œê¸° ë§ìŒ</span>
                            </label>
                            <label class="tag-item">
                                <input type="checkbox" name="personality" value="independent">
                                <span>ë…ë¦½ì </span>
                            </label>
                            <label class="tag-item">
                                <input type="checkbox" name="personality" value="affectionate">
                                <span>ì• êµ ë§ìŒ</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ì¢‹ì•„í•˜ëŠ” ê²ƒ</label>
                        <input type="text" name="likes" placeholder="ì˜ˆ: ê³µë†€ì´, ì‚°ì±…, ê°„ì‹">
                    </div>

                    <div class="form-group">
                        <label>ì‹«ì–´í•˜ëŠ” ê²ƒ</label>
                        <input type="text" name="dislikes" placeholder="ì˜ˆ: ëª©ìš•, í° ì†Œë¦¬, ë‹¤ë¥¸ ë™ë¬¼">
                    </div>
                </div>

                <div class="form-section">
                    <h4>ì‚¬ì§„ ì—…ë¡œë“œ</h4>
                    <div class="image-upload-section">
                        <input type="file" id="pet-images" name="images" multiple accept="image/*" style="display: none;">
                        <div class="upload-area" onclick="document.getElementById('pet-images').click()">
                            <i class="fas fa-camera"></i>
                            <p>ë°˜ë ¤ë™ë¬¼ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                            <small>ìµœëŒ€ 5ì¥ê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥</small>
                        </div>
                        <div class="image-preview-grid" id="image-preview-grid"></div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closePetModal()">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> ì €ì¥í•˜ê¸°
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/mypage.js') }}"></script>
<script>
// í’ˆì¢… ì˜µì…˜ ë°ì´í„°
const breedOptions = {
    dog: ['ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„', 'ë˜ë¸Œë¼ë„ ë¦¬íŠ¸ë¦¬ë²„', 'ì‹œë°”ì´ëˆ„', 'í¬ë©”ë¼ë‹ˆì•ˆ', 'ì¹˜ì™€ì™€', 'ë¶ˆë…', 'í—ˆìŠ¤í‚¤', 'ë§í‹°ì¦ˆ', 'ìš”í¬ì…” í…Œë¦¬ì–´', 'ë³´ë” ì½œë¦¬', 'ê¸°íƒ€'],
    cat: ['ëŸ¬ì‹œì•ˆ ë¸”ë£¨', 'í˜ë¥´ì‹œì•ˆ', 'ë©”ì¸ì¿¤', 'ìƒ´', 'ì•„ë¹„ì‹œë‹ˆì•ˆ', 'ë¸Œë¦¬í‹°ì‹œ ìˆí—¤ì–´', 'ë…¸ë¥´ì›¨ì´ ìˆ²', 'ë™ëŒ', 'ìŠ¤ì½”í‹°ì‹œ í´ë“œ', 'ê¸°íƒ€'],
    rabbit: ['ë„¤ëœë€ë“œ ë“œì›Œí”„', 'í™€ëœë“œ ë¡­', 'ë¼ì´ì–¸í—¤ë“œ', 'ë¯¸ë‹ˆ ë¡­', 'ê¸°íƒ€'],
    bird: ['ì•µë¬´ìƒˆ', 'ì¹´ë‚˜ë¦¬ì•„', 'ì‹­ìë§¤', 'ê¸°íƒ€'],
    hamster: ['ê³¨ë“  í–„ìŠ¤í„°', 'ë“œì›Œí”„ í–„ìŠ¤í„°', 'ê¸°íƒ€'],
    etc: ['ê¸°íƒ€']
};

// ìƒˆ ë°˜ë ¤ë™ë¬¼ ì¶”ê°€
function addNewPet() {
    document.getElementById('pet-modal-title').textContent = 'ìƒˆ ë°˜ë ¤ë™ë¬¼ ì¶”ê°€';
    document.getElementById('pet-form').reset();
    document.getElementById('pet-modal').classList.add('active');
}

// ë°˜ë ¤ë™ë¬¼ í¸ì§‘
function editPet(petId) {
    document.getElementById('pet-modal-title').textContent = 'ë°˜ë ¤ë™ë¬¼ ì •ë³´ ìˆ˜ì •';
    // TODO: ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
    document.getElementById('pet-modal').classList.add('active');
}

// ë°˜ë ¤ë™ë¬¼ ìƒì„¸ë³´ê¸°
function viewPetDetail(petId) {
    // TODO: ìƒì„¸ë³´ê¸° í˜ì´ì§€ë¡œ ì´ë™ ë˜ëŠ” ëª¨ë‹¬ í‘œì‹œ
    alert(`ë°˜ë ¤ë™ë¬¼ ${petId} ìƒì„¸ë³´ê¸°`);
}

// ë°˜ë ¤ë™ë¬¼ ì‚­ì œ
function deletePet(petId) {
    if (confirm('ì •ë§ë¡œ ì´ ë°˜ë ¤ë™ë¬¼ ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ì •ë³´ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        // TODO: ì‹¤ì œ ì‚­ì œ API í˜¸ì¶œ
        alert(`ë°˜ë ¤ë™ë¬¼ ${petId} ì‚­ì œë¨`);
    }
}

// ëª¨ë‹¬ ë‹«ê¸°
function closePetModal() {
    document.getElementById('pet-modal').classList.remove('active');
    document.getElementById('pet-form').reset();
    document.getElementById('image-preview-grid').innerHTML = '';
}

// í’ˆì¢… ì˜µì…˜ ì—…ë°ì´íŠ¸
function updateBreedOptions() {
    const speciesSelect = document.querySelector('select[name="species"]');
    const breedSelect = document.getElementById('breed-select');
    const species = speciesSelect.value;
    
    breedSelect.innerHTML = '<option value="">í’ˆì¢… ì„ íƒ</option>';
    
    if (species && breedOptions[species]) {
        breedOptions[species].forEach(breed => {
            const option = document.createElement('option');
            option.value = breed;
            option.textContent = breed;
            breedSelect.appendChild(option);
        });
    }
}

// ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
document.getElementById('pet-images').addEventListener('change', function(e) {
    const files = e.target.files;
    const previewGrid = document.getElementById('image-preview-grid');
    previewGrid.innerHTML = '';
    
    for (let i = 0; i < Math.min(files.length, 5); i++) {
        const file = files[i];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const imageItem = document.createElement('div');
            imageItem.className = 'image-preview-item';
            imageItem.innerHTML = `
                <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°">
                <button type="button" class="remove-image" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            previewGrid.appendChild(imageItem);
        };
        
        reader.readAsDataURL(file);
    }
});

// í¼ ì œì¶œ ì²˜ë¦¬
document.getElementById('pet-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    try {
        // TODO: ì‹¤ì œ API í˜¸ì¶œ
        alert('ë°˜ë ¤ë™ë¬¼ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        closePetModal();
        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” ë™ì  ì—…ë°ì´íŠ¸
        location.reload();
    } catch (error) {
        alert('ë°˜ë ¤ë™ë¬¼ ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
});

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.getElementById('pet-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closePetModal();
    }
});

// ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closePetModal();
    }
});
</script>
{% endblock %}