{% extends "base.html" %}

{% block title %}ì¼ê¸° ì‘ì„± - MyPet's Voice{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/diary.css') }}">
{% endblock %}

{% block content %}
<div class="diary-create-container">
    <div class="diary-create-header">
        <h2>ìƒˆ ì¼ê¸° ì‘ì„±</h2>
        <div class="header-actions">
            <a href="{{ url_for('diary.index') }}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
            </a>
        </div>
    </div>

    <form id="diary-form" class="diary-form">
        <div class="form-section">
            <h3>ê¸°ë³¸ ì •ë³´</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="pet-select">ë°˜ë ¤ë™ë¬¼ ì„ íƒ *</label>
                    <select id="pet-select" name="pet_id" required>
                        <option value="">ë°˜ë ¤ë™ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- TODO: ë°˜ë ¤ë™ë¬¼ ëª©ë¡ ë™ì  ë¡œë“œ -->
                        <option value="1">ë©ë©ì´ (ê°œ)</option>
                        <option value="2">ì•¼ì˜¹ì´ (ê³ ì–‘ì´)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="diary-date">ë‚ ì§œ *</label>
                    <input type="date" id="diary-date" name="diary_date" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="weather">ë‚ ì”¨</label>
                    <select id="weather" name="weather">
                        <option value="">ë‚ ì”¨ ì„ íƒ</option>
                        <option value="sunny">â˜€ï¸ ë§‘ìŒ</option>
                        <option value="cloudy">â˜ï¸ íë¦¼</option>
                        <option value="rainy">ğŸŒ§ï¸ ë¹„</option>
                        <option value="snowy">â„ï¸ ëˆˆ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="mood">ê¸°ë¶„</label>
                    <select id="mood" name="mood">
                        <option value="">ê¸°ë¶„ ì„ íƒ</option>
                        <option value="happy">ğŸ˜Š í–‰ë³µí•´ìš”</option>
                        <option value="excited">ğŸ˜† ì‹ ë‚˜ìš”</option>
                        <option value="calm">ğŸ˜Œ í‰ì˜¨í•´ìš”</option>
                        <option value="sad">ğŸ˜¢ ìŠ¬í¼ìš”</option>
                        <option value="tired">ğŸ˜´ í”¼ê³¤í•´ìš”</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>ì¼ê¸° ë‚´ìš©</h3>
            <div class="form-group">
                <label for="diary-title">ì œëª© *</label>
                <input type="text" id="diary-title" name="title" required 
                       placeholder="ì˜¤ëŠ˜ì˜ ì¼ê¸° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div class="form-group">
                <label for="diary-content">ë‚´ìš© *</label>
                <textarea id="diary-content" name="content" required 
                          placeholder="ë°˜ë ¤ë™ë¬¼ì˜ í•˜ë£¨ë¥¼ ìì„¸íˆ ê¸°ë¡í•´ì£¼ì„¸ìš”..."></textarea>
                <div class="content-help">
                    <small>ğŸ’¡ íŒ: ë°˜ë ¤ë™ë¬¼ì˜ ê´€ì ì—ì„œ ì‘ì„±í•´ë³´ì„¸ìš”!</small>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>ì‚¬ì§„ ë° ì„¤ì •</h3>
            <div class="form-group">
                <label for="diary-images">ì‚¬ì§„ ì²¨ë¶€</label>
                <div class="image-upload-area" id="image-upload-area">
                    <input type="file" id="diary-images" name="images" multiple accept="image/*">
                    <div class="upload-placeholder">
                        <i class="fas fa-camera"></i>
                        <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                        <small>ìµœëŒ€ 5ì¥ê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥</small>
                    </div>
                </div>
                <div class="image-preview" id="image-preview"></div>
            </div>

            <div class="form-group">
                <label class="checkbox-wrapper">
                    <input type="checkbox" name="is_public" value="1">
                    <span class="checkmark"></span>
                    ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ê³¼ ê³µìœ í•˜ê¸°
                </label>
                <small class="help-text">ì²´í¬í•˜ë©´ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ë³¼ ìˆ˜ ìˆì–´ìš”</small>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-outline" onclick="history.back()">
                ì·¨ì†Œ
            </button>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> ì¼ê¸° ì €ì¥
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/diary.js') }}"></script>
<script>
// ì˜¤ëŠ˜ ë‚ ì§œë¡œ ê¸°ë³¸ê°’ ì„¤ì •
document.getElementById('diary-date').valueAsDate = new Date();

// ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
document.getElementById('diary-images').addEventListener('change', function(e) {
    const files = e.target.files;
    const preview = document.getElementById('image-preview');
    preview.innerHTML = '';
    
    for (let i = 0; i < Math.min(files.length, 5); i++) {
        const file = files[i];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const div = document.createElement('div');
            div.className = 'image-preview-item';
            div.innerHTML = `
                <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°">
                <button type="button" class="remove-image" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            preview.appendChild(div);
        };
        
        reader.readAsDataURL(file);
    }
});

// í¼ ì œì¶œ ì²˜ë¦¬
document.getElementById('diary-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    try {
        const response = await fetch('{{ url_for("diary.create") }}', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
            alert('ì¼ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            window.location.href = '{{ url_for("diary.index") }}';
        } else {
            alert('ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    } catch (error) {
        alert('ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
});
</script>
{% endblock %}