{% extends "base.html" %}

{% block title %}반려동물 일기 - PetCare{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-book text-success"></i> 반려동물 일기</h2>
    <div class="d-flex gap-2">
        <select class="form-select" id="petFilter" style="width: auto;">
            <option value="">모든 반려동물</option>
            {% for pet in pets %}
            <option value="{{ pet.id }}">{{ pet.name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

{% if pets %}
<div class="row mb-4">
    {% for pet in pets %}
    <div class="col-md-6 col-lg-4 mb-3">
        <div class="card h-100 diary-pet-card" data-pet-id="{{ pet.id }}">
            <div class="card-body text-center">
                <div class="mb-3">
                    {% if pet.profile_image %}
                        <img src="{{ pet.profile_image }}" alt="{{ pet.name }}" class="rounded-circle" width="80" height="80">
                    {% else %}
                        <div class="bg-success rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 80px; height: 80px;">
                            <i class="fas fa-paw text-white fa-2x"></i>
                        </div>
                    {% endif %}
                </div>
                
                <h5 class="card-title">{{ pet.name }}</h5>
                <p class="text-muted">{{ pet.species }}</p>
                
                <div class="mb-3">
                    <small class="text-muted">
                        <i class="fas fa-book"></i> 
                        {% set diary_count = pet.diaries|length %}
                        {{ diary_count }}개의 일기
                    </small>
                </div>
                
                <div class="d-grid gap-2">
                    <a href="{{ url_for('write_diary', pet_id=pet.id) }}" class="btn btn-success">
                        <i class="fas fa-edit"></i> 새 일기 작성
                    </a>
                    <a href="{{ url_for('pet_diary', pet_id=pet.id) }}" class="btn btn-outline-success">
                        <i class="fas fa-list"></i> 일기 보기
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- 최근 일기 목록 -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-clock text-primary"></i> 최근 작성된 일기</h5>
    </div>
    <div class="card-body">
        <div id="recentDiariesContainer">
            <!-- 동적으로 로드될 내용 -->
            <div class="text-center py-4">
                <div class="loading-spinner"></div>
                <p class="mt-2 text-muted">일기를 불러오는 중...</p>
            </div>
        </div>
    </div>
</div>

{% else %}
<div class="text-center py-5">
    <i class="fas fa-paw fa-4x text-muted mb-4"></i>
    <h3 class="text-muted">아직 등록된 반려동물이 없어요</h3>
    <p class="text-muted mb-4">반려동물을 먼저 등록하고 일기를 작성해보세요!</p>
    <a href="{{ url_for('add_pet') }}" class="btn btn-primary btn-lg">
        <i class="fas fa-plus"></i> 반려동물 등록하기
    </a>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadRecentDiaries();
    
    // 반려동물 필터
    document.getElementById('petFilter').addEventListener('change', function() {
        const selectedPetId = this.value;
        filterPetCards(selectedPetId);
    });
});

function filterPetCards(petId) {
    const cards = document.querySelectorAll('.diary-pet-card');
    
    cards.forEach(card => {
        const cardPetId = card.getAttribute('data-pet-id');
        
        if (!petId || cardPetId === petId) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

async function loadRecentDiaries() {
    try {
        // 실제로는 API를 호출해야 하지만, 데모용으로 임시 데이터 표시
        const container = document.getElementById('recentDiariesContainer');
        
        setTimeout(() => {
            container.innerHTML = `
                <div class="text-center py-4 text-muted">
                    <i class="fas fa-book fa-3x mb-3"></i>
                    <p>아직 작성된 일기가 없어요.</p>
                    <p>첫 번째 일기를 작성해보세요!</p>
                </div>
            `;
        }, 1000);
        
    } catch (error) {
        console.error('일기 로드 오류:', error);
        document.getElementById('recentDiariesContainer').innerHTML = `
            <div class="text-center py-4 text-danger">
                <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                <p>일기를 불러오는 중 오류가 발생했습니다.</p>
            </div>
        `;
    }
}

// 카드 hover 효과
document.querySelectorAll('.diary-pet-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.02)';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
    });
});
</script>
{% endblock %}